version: 2

models:
  - name: stg_shopify__customer
    description: Each record represents a customer in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - customer_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: has_accepted_marketing
        description: Whether the customer has consented to receive marketing material via email.
      - name: created_timestamp
        description: The date and time when the customer was created.
      - name: default_address_id
        description: The default address for the customer.
      - name: email
        description: The unique email address of the customer. Attempting to assign the same email address to multiple customers returns an error.
      - name: first_name
        description: The customer's first name.
      - name: customer_id
        description: A unique identifier for the customer.
      - name: last_name
        description: The customer's last name.
      - name: orders_count
        description: The number of orders associated with this customer.
      - name: phone
        description: The unique phone number (E.164 format) for this customer. Attempting to assign the same phone number to multiple customers returns an error.
      - name: account_state
        description: The state of the customer's account with a shop.
      - name: is_tax_exempt
        description: Whether the customer is exempt from paying taxes on their order. If true, then taxes won't be applied to an order at checkout. If false, then taxes will be applied at checkout.
      - name: total_spent
        description: The total amount of money that the customer has spent across their order history.
      - name: updated_timestamp
        description: The date and time when the customer information was last updated.
      - name: is_verified_email
        description: Whether the customer has verified their email address.

  - name: stg_shopify__order_line_refund
    description: Each record represents a line item from an order in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_line_refund_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: order_line_refund_id
        description: The unique identifier of the line item in the refund.
      - name: location_id
        description: TThe unique identifier of the location where the items will be restockedBD
      - name: order_line_id
        description: The ID of the related line item in the order.
      - name: quantity
        description: The quantity of the associated line item that was returned.
      - name: refund_id
        description: The ID of the related refund.
      - name: restock_type
        description: How this refund line item affects inventory levels.
      - name: subtotal
        description: Subtotal amount of the order line refund
      - name: total_tax
        description: The total tax applied to the refund.

  - name: stg_shopify__order_line
    description: Each record represents a line item from an order in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_line_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: fulfillable_quantity
        description: "The amount available to fulfill, calculated as follows: quantity - max(refunded_quantity, fulfilled_quantity) - pending_fulfilled_quantity - open_fulfilled_quantity"
      - name: fulfillment_service
        description: The service provider that's fulfilling the item.
      - name: fulfillment_status
        description: How far along an order is in terms line items fulfilled.
      - name: is_gift_card
        description: Whether the item is a gift card. If true, then the item is not taxed or considered for shipping charges.
      - name: grams
        description: The weight of the item in grams.
      - name: order_line_id
        description: The ID of the line item.
      - name: name
        description: The name of the product variant.
      - name: order_id
        description: The ID of the related order.
      - name: price
        description: The price of the item before discounts have been applied in the shop currency.
      - name: product_id
        description: The ID of the product that the line item belongs to. Can be null if the original product associated with the order is deleted at a later date.
      - name: quantity
        description: The number of items that were purchased.
      - name: is_requiring_shipping
        description: Whether the item requires shipping.
      - name: sku
        description: The item's SKU (stock keeping unit).
      - name: is_taxable
        description: Whether the item was taxable.
      - name: title
        description: The title of the product.
      - name: total_discount
        description: The total amount of the discount allocated to the line item in the shop currency.
      - name: variant_id
        description: The ID of the product variant.
      - name: vendor
        description: The name of the item's supplier.

  - name: stg_shopify__order
    description: Each record represents an order in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: app_id
        description: The ID of the app that created the order.
      - name: billing_address_address_1
        description: The street address of the billing address.
      - name: billing_address_address_2
        description: An optional additional field for the street address of the billing address.
      - name: billing_address_city
        description: The city, town, or village of the billing address.
      - name: billing_address_company
        description: The company of the person associated with the billing address.
      - name: billing_address_country
        description: The name of the country of the billing address.
      - name: billing_address_country_code
        description: The two-letter code (ISO 3166-1 format) for the country of the billing address.
      - name: billing_address_first_name
        description: The first name of the person associated with the payment method.
      - name: billing_address_last_name
        description: The last name of the person associated with the payment method.
      - name: billing_address_latitude
        description: The latitude of the billing address.
      - name: billing_address_longitude
        description: The longitude of the billing address.
      - name: billing_address_name
        description: The full name of the person associated with the payment method.
      - name: billing_address_phone
        description: The phone number at the billing address.
      - name: billing_address_province
        description: The name of the region (province, state, prefecture, …) of the billing address.
      - name: billing_address_province_code
        description: The two-letter abbreviation of the region of the billing address.
      - name: billing_address_zip
        description: The postal code (zip, postcode, Eircode, …) of the billing address.
      - name: browser_ip
        description: The IP address of the browser used by the customer when they placed the order.
      - name: has_buyer_accepted_marketing
        description: Whether the customer consented to receive email updates from the shop.
      - name: cancel_reason
        description: The reason why the order was canceled.
      - name: cancelled_timestamp
        description: The date and time when the order was canceled.
      - name: cart_token
        description: The ID of the cart that's associated with the order.
      - name: closed_timestamp
        description: The date and time when the order was closed.
      - name: created_timestamp
        description: The autogenerated date and time when the order was created in Shopify.
      - name: currency
        description: The three-letter code for the shop currency.
      - name: customer_id
        description: The ID of the order's customer.
      - name: email
        description: The customer's email address.
      - name: financial_status
        description: The status of payments associated with the order. Can only be set when the order is created
      - name: fulfillment_status
        description: The order's status in terms of fulfilled line items.
      - name: order_id
        description: The ID of the order, used for API purposes. This is different from the order_number property, which is the ID used by the shop owner and customer.
      - name: landing_site_base_url
        description: The URL for the page where the buyer landed when they entered the shop.
      - name: location_id
        description: The ID of the physical location where the order was processed.
      - name: name
        description: The order name, generated by combining the order_number property with the order prefix and suffix that are set in the merchant's general settings.
      - name: note
        description: An optional note that a shop owner can attach to the order.
      - name: number
        description: The order's position in the shop's count of orders. Numbers are sequential and start at 1.
      - name: order_number
        description: The order 's position in the shop's count of orders starting at 1001. Order numbers are sequential and start at 1001.
      - name: processed_timestamp
        description: The date and time when an order was processed. This value is the date that appears on your orders and that's used in the analytic reports.
      - name: processing_method
        description: How the payment was processed.
      - name: referring_site
        description: The website where the customer clicked a link to the shop.
      - name: shipping_address_address_1
        description: The street address of the shipping address.
      - name: shipping_address_address_2
        description: An optional additional field for the street address of the shipping address.
      - name: shipping_address_city
        description: The city, town, or village of the shipping address.
      - name: shipping_address_company
        description: The company of the person associated with the shipping address.
      - name: shipping_address_country
        description: The name of the country of the shipping address.
      - name: shipping_address_country_code
        description: The two-letter code (ISO 3166-1 format) for the country of the shipping address.
      - name: shipping_address_first_name
        description: The first name of the person associated with the shipping address.
      - name: shipping_address_last_name
        description: The last name of the person associated with the shipping address.
      - name: shipping_address_latitude
        description: The latitude of the shipping address.
      - name: shipping_address_longitude
        description: The longitude of the shipping address.
      - name: shipping_address_name
        description: The full name of the person associated with the payment method.
      - name: shipping_address_phone
        description: The phone number at the shipping address.
      - name: shipping_address_province
        description: The name of the region (province, state, prefecture, …) of the shipping address.
      - name: shipping_address_province_code
        description: The two-letter abbreviation of the region of the shipping address.
      - name: shipping_address_zip
        description: The postal code (zip, postcode, Eircode, …) of the shipping address.
      - name: source_name
        description: Where the order originated. Can be set only during order creation, and is not writeable afterwards.
      - name: subtotal_price
        description: The price of the order in the shop currency after discounts but before shipping, taxes, and tips.
      - name: has_taxes_included
        description: Whether taxes are included in the order subtotal.
      - name: is_test_order
        description: Whether this is a test order.
      - name: token
        description: A unique token for the order.
      - name: total_discounts
        description: The total discounts applied to the price of the order in the shop currency.
      - name: total_line_items_price
        description: The sum of all line item prices in the shop currency.
      - name: total_price
        description: The sum of all line item prices, discounts, shipping, taxes, and tips in the shop currency. Must be positive.
      - name: total_tax
        description: The sum of all the taxes applied to the order in th shop currency. Must be positive).
      - name: total_weight
        description: The sum of all line item weights in grams.
      - name: updated_timestamp
        description: The date and time (ISO 8601 format) when the order was last modified.
      - name: user_id
        description: The ID of the user logged into Shopify POS who processed the order, if applicable.
      - name: total_shipping_price_set
        description: The total shipping price set for the order.
      - name: index
        description: The index associated with the order.
      - name: pre_tax_price
        description: The total pre tax price of the order.

  - name: stg_shopify__product
    description: Each record represents a product in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - product_id
            - source_relation
    columns:
      - name: _fivetran_deleted
        description: Whether the record has been deleted in the source system.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: created_timestamp
        description: The date and time when the product was created.
      - name: handle
        description: A unique human-friendly string for the product. Automatically generated from the product's title.
      - name: product_id
        description: An unsigned 64-bit integer that's used as a unique identifier for the product. Each id is unique across the Shopify system. No two products will have the same id, even if they're from different shops.
      - name: product_type
        description: A categorization for the product used for filtering and searching products.
      - name: published_timestamp
        description: The date and time (ISO 8601 format) when the product was published. Can be set to null to unpublish the product from the Online Store channel.
      - name: published_scope
        description: Whether the product is published to the Point of Sale channel.
      - name: title
        description: The name of the product.
      - name: updated_timestamp
        description: The date and time when the product was last modified.
      - name: vendor
        description: The name of the product's vendor.

  - name: stg_shopify__product_variant
    description: Each record represents a product variant in Shopify
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - variant_id
            - source_relation
    columns:
      - name: barcode
        description: The barcode, UPC, or ISBN number for the product.
      - name: compare_at_price
        description: The original price of the item before an adjustment or a sale.
      - name: created_timestamp
        description: The date and time (ISO 8601 format) when the product variant was created.
      - name: fulfillment_service
        description: The fulfillment service associated with the product variant.
      - name: grams
        description: The weight of the product variant in grams.
      - name: variant_id
        description: The unique numeric identifier for the product variant.
      - name: image_id
        description: The unique numeric identifier for a product's image. The image must be associated to the same product as the variant.
      - name: inventory_item_id
        description: The unique identifier for the inventory item, which is used in the Inventory API to query for inventory information.
      - name: inventory_management
        description: The fulfillment service that tracks the number of items in stock for the product variant.
      - name: inventory_policy
        description: Whether customers are allowed to place an order for the product variant when it's out of stock.
      - name: inventory_quantity
        description: An aggregate of inventory across all locations. To adjust inventory at a specific location, use the InventoryLevel resource.
      - name: old_inventory_quantity
        description: This property is deprecated. Use the InventoryLevel resource instead.
      - name: option_1
        description: "The custom properties that a shop owner uses to define product variants. You can define three options for a product variant: option1, option2, option3."
      - name: option_2
        description: "The custom properties that a shop owner uses to define product variants. You can define three options for a product variant: option1, option2, option3."
      - name: option_3
        description: "The custom properties that a shop owner uses to define product variants. You can define three options for a product variant: option1, option2, option3."
      - name: position
        description: The order of the product variant in the list of product variants. The first position in the list is 1. The position of variants is indicated by the order in which they are listed.
      - name: price
        description: The price of the product variant.
      - name: product_id
        description: The unique numeric identifier for the product.
      - name: is_requiring_shipping
        description: This property is deprecated. Use the `requires_shipping` property on the InventoryItem resource instead.
      - name: sku
        description: A unique identifier for the product variant in the shop. Required in order to connect to a FulfillmentService.
      - name: is_taxable
        description: Whether a tax is charged when the product variant is sold.
      - name: tax_code
        description: This parameter applies only to the stores that have the Avalara AvaTax app installed. Specifies the Avalara tax code for the product variant.
      - name: title
        description: The title of the product variant. The title field is a concatenation of the option1, option2, and option3 fields. You can only update title indirectly using the option fields.
      - name: updated_timestamp
        description: The date and time when the product variant was last modified. Gets returned in ISO 8601 format.
      - name: weight
        description: The weight of the product variant in the unit system specified with weight_unit.
      - name: weight_unit
        description: "The unit of measurement that applies to the product variant's weight. If you don't specify a value for weight_unit, then the shop's default unit of measurement is applied. Valid values: g, kg, oz, and lb."
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"

  - name: stg_shopify__transaction
    description: Each record represents a transaction in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_id
            - source_relation
    columns:
      - name: transaction_id
        description: The ID for the transaction.
      - name: order_id
        description: The ID for the order that the transaction is associated with.
      - name: refund_id
        description: The ID associated with a refund in the refund table.
      - name: amount
        description: The amount of money included in the transaction.
      - name: authorization
        description: The authorization code associated with the transaction.
      - name: created_timestamp
        description: The date and time when the transaction was created.
      - name: processed_timestamp
        description: The date and time when a transaction was processed.
      - name: device_id
        description: The ID for the device.
      - name: gateway
        description: The name of the gateway the transaction was issued through.
      - name: source_name
        description: The origin of the transaction.
      - name: message
        description: A string generated by the payment provider with additional information about why the transaction succeeded or failed.
      - name: currency
        description: The three-letter code (ISO 4217 format) for the currency used for the payment.
      - name: location_id
        description: The ID of the physical location where the transaction was processed.
      - name: parent_id
        description: The ID of an associated transaction.
      - name: payment_avs_result_code
        description: The response code from the address verification system.
      - name: payment_credit_card_bin
        description: The issuer identification number (IIN), formerly known as bank identification number (BIN) of the customer's credit card.
      - name: payment_cvv_result_code
        description: The response code from the credit card company indicating whether the customer entered the card security code, or card verification value, correctly.
      - name: payment_credit_card_number
        description: The customer's credit card number, with most of the leading digits redacted.
      - name: payment_credit_card_company
        description: The name of the company that issued the customer's credit card.
      - name: kind
        description: The transaction's type.
      - name: receipt
        description: A transaction receipt attached to the transaction by the gateway.
      - name: currency_exchange_id
        description: The ID of the adjustment.
      - name: currency_exchange_adjustment
        description: The difference between the amounts on the associated transaction and the parent transaction.
      - name: currency_exchange_original_amount
        description: The amount of the parent transaction in the shop currency.
      - name: currency_exchange_final_amount
        description: The amount of the associated transaction in the shop currency.
      - name: currency_exchange_currency
        description: The shop currency.
      - name: error_code
        description: A standardized error code, independent of the payment provider.
      - name: status
        description: The status of the transaction.
      - name: test
        description: Whether the transaction is a test transaction.
      - name: user_id
        description: The ID for the user who was logged into the Shopify POS device when the order was processed, if applicable.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"

  - name: stg_shopify__refund
    description: Each record represents a refund within Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - refund_id
            - source_relation
    columns:
      - name: refund_id
        description: The unique numeric identifier for the refund.
      - name: created_at
        description: Timestamp of the date when the refund was created.
      - name: processed_at
        description: Timestamp of the date when the refund was processed.
      - name: note
        description: User generated note attached to the refund.
      - name: restock
        description: Boolean indicating if the refund is a result of a restock.
      - name: user_id
        description: Reference to the user id which generated the refund.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: total_duties_set
        description: Record representing total duties set for the refund.
      - name: order_id
        description: Reference to the order which the refund is associated.

  - name: stg_shopify__order_adjustment
    description: Each record represents and adjustment to and order within Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_adjustment_id
            - source_relation
    columns:
      - name: order_adjustment_id
        description: The unique numeric identifier for the order adjustment.
      - name: order_id
        description: Reference to the order which the adjustment is associated.
      - name: refund_id
        description: Reference to the refund which the adjustment is associated.
      - name: amount
        description: Amount of the adjustment.
      - name: tax_amount
        description: Tax amount applied to the order adjustment.
      - name: kind
        description: The kind of order adjustment (eg. refund, restock, etc.).
      - name: reason
        description: The reason for the order adjustment.
      - name: amount_set
        description: Amount set towards the order adjustment
      - name: tax_amount_set
        description: Tax amount set towards the order adjustment.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"

  - name: stg_shopify__metafield
    description: Each record represents an entry into a metafield.
    columns:
      - name: metafield_id
        description: The unique numeric identifier for the metafield.
        tests:
          - unique
          - not_null
      - name: owner_id
        description: ID of the owner_resource (e.g. if the owner_resource is "Customer" then the owner_id is the customer_id)
      - name: namespace
        description: TBD
      - name: key
        description: Name of the metafield that was created
      - name: value
        description: >
          Value that the metafield takes on for the owner_resource (e.g. for key=pharmacy_npi, value=1487235768 for a 
          partner pharmacy Customer)
      - name: description
        description: TBD
      - name: owner_resource
        description: Resource that the metafield is associated with (Customer, Product, Shop, Order, etc.)
      - name: type
        description: Data type of the value field
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}" 
